<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 07 August 2013
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="iso-8859-1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20130807" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Apache Common Monitoring - </title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.0.min.js"></script>

                          
        
<link rel="stylesheet" type="text/css" media="all" href="./css/prettify.css"/>
                      
        
<script src="./js/prettify.js" type="text/javascript"></script>
                      
        
<script type="text/javascript">window.onload=function() {
              prettyPrint();
          }</script>
          
            </head>
        <body class="topBarEnabled">
          
                        
                    
                

    <div id="topbar" class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
                                  <div class="container"><div class="nav-collapse">
            
                
                    
                                <ul class="nav">
                          <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">User Guide <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="concepts.html"  title="Concepts">Concepts</a>
</li>
                  
                      <li>      <a href="basis.html"  title="Basis">Basis</a>
</li>
                  
                      <li>      <a href="configuration.html"  title="Configuration">Configuration</a>
</li>
                  
                      <li>      <a href="instrumentation.html"  title="Instrumentation">Instrumentation</a>
</li>
                  
                      <li>      <a href="reporting.html"  title="Reporting">Reporting</a>
</li>
                  
                      <li>      <a href="plugins.html"  title="Plugins">Plugins</a>
</li>
                          </ul>
      </li>
                <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Project Documentation <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li class="dropdown-submenu">
                                      <a href="project-info.html"  title="Project Information">Project Information</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="index.html"  title="About">About</a>
</li>
                                  <li>      <a href="project-summary.html"  title="Project Summary">Project Summary</a>
</li>
                                  <li>      <a href="modules.html"  title="Project Modules">Project Modules</a>
</li>
                                  <li>      <a href="team-list.html"  title="Project Team">Project Team</a>
</li>
                                  <li>      <a href="source-repository.html"  title="Source Repository">Source Repository</a>
</li>
                                  <li>      <a href="issue-tracking.html"  title="Issue Tracking">Issue Tracking</a>
</li>
                                  <li>      <a href="mail-lists.html"  title="Mailing Lists">Mailing Lists</a>
</li>
                                  <li>      <a href="dependency-management.html"  title="Dependency Management">Dependency Management</a>
</li>
                                  <li>      <a href="dependencies.html"  title="Dependencies">Dependencies</a>
</li>
                                  <li>      <a href="dependency-convergence.html"  title="Dependency Convergence">Dependency Convergence</a>
</li>
                                  <li>      <a href="integration.html"  title="Continuous Integration">Continuous Integration</a>
</li>
                                  <li>      <a href="distribution-management.html"  title="Distribution Management">Distribution Management</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="project-reports.html"  title="Project Reports">Project Reports</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="jira-report.html"  title="JIRA Report">JIRA Report</a>
</li>
                                  <li>      <a href="apidocs/index.html"  title="JavaDocs">JavaDocs</a>
</li>
                                  <li>      <a href="testapidocs/index.html"  title="Test JavaDocs">Test JavaDocs</a>
</li>
                                  <li>      <a href="xref/index.html"  title="Source Xref">Source Xref</a>
</li>
                                  <li>      <a href="xref-test/index.html"  title="Test Source Xref">Test Source Xref</a>
</li>
                                  <li>      <a href="surefire-report.html"  title="Surefire Report">Surefire Report</a>
</li>
                                  <li>      <a href="rat-report.html"  title="RAT Report">RAT Report</a>
</li>
                                  <li>      <a href="cpd.html"  title="CPD Report">CPD Report</a>
</li>
                                  <li>      <a href="pmd.html"  title="PMD Report">PMD Report</a>
</li>
                                  <li>      <a href="taglist.html"  title="Tag List">Tag List</a>
</li>
                              </ul>
            </li>
                          </ul>
      </li>
                <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Commons <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="../../"  title="Home">Home</a>
</li>
                  
                      <li>      <a href="http://www.apache.org/licenses/"  title="License">License</a>
</li>
                  
                      <li class="dropdown-submenu">
                                      <a href="../../components.html"  title="Components">Components</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="../../components.html"  title="Full list...">Full list...</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="../index.html"  title="Sandbox">Sandbox</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="../index.html"  title="Full list...">Full list...</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="../../dormant/index.html"  title="Dormant">Dormant</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="../../dormant/index.html"  title="Full list...">Full list...</a>
</li>
                              </ul>
            </li>
                          </ul>
      </li>
                <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">General Information <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="../../volunteering.html"  title="Volunteering">Volunteering</a>
</li>
                  
                      <li>      <a href="../../patches.html"  title="Contributing Patches">Contributing Patches</a>
</li>
                  
                      <li>      <a href="../../building.html"  title="Building Components">Building Components</a>
</li>
                  
                      <li>      <a href="../../releases/index.html"  title="Releasing Components">Releasing Components</a>
</li>
                  
                      <li>      <a href="http://wiki.apache.org/commons/FrontPage"  title="Wiki">Wiki</a>
</li>
                          </ul>
      </li>
                <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">ASF <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="http://www.apache.org/foundation/how-it-works.html"  title="How the ASF works">How the ASF works</a>
</li>
                  
                      <li>      <a href="http://www.apache.org/foundation/getinvolved.html"  title="Get Involved">Get Involved</a>
</li>
                  
                      <li>      <a href="http://www.apache.org/dev/"  title="Developer Resources">Developer Resources</a>
</li>
                  
                      <li>      <a href="http://www.apache.org/foundation/sponsorship.html"  title="Sponsorship">Sponsorship</a>
</li>
                  
                      <li>      <a href="http://www.apache.org/foundation/thanks.html"  title="Thanks">Thanks</a>
</li>
                          </ul>
      </li>
                  </ul>
          
          
                                                              
                               <ul class="nav pull-right">
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">External Links <b class="caret"></b></a>
                <ul class="dropdown-menu">
                      <li>      <a href="http://www.apachecon.com/"  title="ApacheCon">ApacheCon</a>
</li>
      <li>      <a href="http://www.apache.org"  title="Apache">Apache</a>
</li>
      <li>      <a href="../../"  title="Commons">Commons</a>
</li>
      <li>      <a href="../"  title="Sandbox">Sandbox</a>
</li>
                  </ul>
              </li>
            </ul>
          
                      </div>
          
        </div>
      </div>
    </div>
    
        <div class="container">
          <div id="banner">
        <div class="pull-left">
                                                  <a href="index.html" id="bannerLeft" title="Apache Commons logo">
                                                                                                <img src="images/commons-logo.png"  alt="Apache Commons logo"/>
                </a>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 07 August 2013</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 1.0-SNAPSHOT</li>
                      
                
                    
      
                            </ul>
      </div>

      
                
        <div id="bodyColumn" >
                                  
            <!-- -
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License. --><div class="section">
<h2>Plugins<a name="Plugins"></a></h2>
<p>There are several kind of plugins:</p>

<ul>
  
<li><tt>org.apache.commons.monitoring.gauges.Gauge</tt> and <tt>org.apache.commons.monitoring.gauges.GaugeFactory</tt>: you can add your own gauges</li>
  
<li><tt>org.apache.commons.monitoring.reporting.web.plugin.Plugin</tt>: add feature to the web GUI</li>
</ul></div>
<div class="section">
<h2>Write your own gauge<a name="Write_your_own_gauge"></a></h2>
<p>To add your own Gauge you have two main solutions:</p>

<ul>
  
<li>simply implement a <tt>org.apache.commons.monitoring.gauges.Gauge</tt> and register it using ServiceLoader mecanism (META-INF/services/org.apache.commons.monitoring.gauges.Gauge)</li>
  
<li>implement a <tt>org.apache.commons.monitoring.gauges.GaugeFactory</tt> which is registered it using ServiceLoader mecanism (META-INF/services/org.apache.commons.monitoring.gauges.GaugeFactory) and return the gauges you want to register</li>
</ul>
<p>What is GaugeFactory designed for? Imagine a custom gauge is parameterized. You&#x2019;ll surely want to register it several times with different parameters. If you use Gauge SPI you&#x2019;ll need to do N implementations (which makes the parameters useless). With GaugeFactory you just need to return the built instances:</p>

<div class="source">
<pre>public class MyGaugeFactory implements GaugeFactory {
    @Override
    public Gauge[] gauges() {
        return new Gauge[] { new MyGauge(1); new MyGauge(2); };
    }
}
</pre></div></div>
<div class="section">
<h2>Extend the reporting GUI<a name="Extend_the_reporting_GUI"></a></h2>
<p>To extend the reporting GUI just write your own <tt>org.apache.commons.monitoring.reporting.web.plugin.Plugin</tt>. Here too it relies on java ServiceLoader (SPI) mecanism.</p>
<p>Here is the Plugin interface:</p>

<div class="source">
<pre>public interface Plugin {
    String name();
    Class&lt;?&gt; endpoints();
    String mapping();
}
</pre></div>
<p>A plugin has basically a name (what will identify it in the webapp and in the GUI - it will be the name of the plugin tab), a mapping, ie which base subcontext it will use for its own pages (for instance /jmx, /myplugin &#x2026;) and a class representing endpoints.</p>
<p>To make it more concrete we&#x2019;ll use a sample (the standard Hello World).</p>
<div class="section">
<h3>Define the plugin<a name="Define_the_plugin"></a></h3>
<p>So first we define our HelloPlugin:</p>

<div class="source">
<pre>public class HelloPlugin implements Plugin {
    public String name() {
        return &quot;Hello&quot;;
    }

    public Class&lt;?&gt; endpoints() {
        return HelloEndpoints.class;
    }

    public String mapping() {
        return &quot;/hello&quot;;
    }
}
</pre></div></div>
<div class="section">
<h3>Define the endpoints<a name="Define_the_endpoints"></a></h3>
<p>The <tt>HelloEndpoints</tt> class defines all the urls accessible for the hello plugin. It uses the <tt>org.apache.commons.monitoring.reporting.web.handler.api.Regex</tt> annotation:</p>

<div class="source">
<pre>public class HelloEndpoints {
    @Regex // will match &quot;/hello&quot;
    public Template home() {
        return new Template(&quot;hello/home.vm&quot;, new MapBuilder&lt;String, Object&gt;().set(&quot;name&quot;, &quot;world).build());
    }

    @Regex(&quot;/world/([0-9]*)/([0-9]*)&quot;) // will match &quot;/hello/world/1/2&quot;
    public String jsonWorld(final long start, final long end) {
        return &quot;{ \&quot;name\&quot;: \world\&quot;, \&quot;start\&quot;:\&quot;&quot; + long1 + &quot;\&quot;,\&quot;end\&quot;:\&quot;&quot; + long2 + &quot;\&quot;}&quot;;
    }
}
</pre></div>
<p>The first home method uses a template. The GUI relies on velocity and html templates needs to be in the classloader in templates directory.</p>
<p>So basically the home method will search for templates/hello/home.vm velocity template. It is only the &#x201c;main&#x201d; part of the GUI (the tabs are automatically added). Twitter bootstrap (2.3.2) and JQuery are available.</p>
<p>Here is a sample:</p>

<div class="source">
<pre>&lt;h1&gt;Hello&lt;/h1&gt;
&lt;div&gt;
    Welcome to $name
&lt;/div&gt;
</pre></div>
<p>If you need resources put them in the classloader too in &#x201c;resources&#x201d; folder.</p>
<p>Note: if you want to do links in the template you can use $mapping variable as base context of your link. For instance: &gt;a href=&#x201c;$mapping/foo&#x201d;&lt;Foo&gt;/a&lt;.</p>
<p>If you want to filter some resources you can add a custom endpoint:</p>

<div class="source">
<pre>@Regex(&quot;/resources/myresource.css&quot;)
public void filterCss(final TemplateHelper helper) {
    helper.renderPlain(&quot;/resources/myresource.css&quot;);
}
</pre></div>
<div class="section">
<h4><tt>@Regex</tt><a name="aRegex"></a></h4>
<p><tt>@Regex</tt> allows you to get injected path segments, here is what is handled:</p>

<ul>
  
<li>HttpServletRequest</li>
  
<li>HttpServletResponse</li>
  
<li>TemplateHelper (should be used when you want to render a velocity template which is not in /templates and is not decorated by the default GUI layout)</li>
  
<li>String: will inject the matching element of the regex (it is indexed = if you inject 2 strings the first one will be the first group and the second one the second group)</li>
  
<li>Long, Integer: same as for String but converted</li>
  
<li>String[]: all not yet matched segments of the regex</li>
</ul>
<p>For instance <tt>@Regex(&quot;/operation/([^/]*)/([^/]*)/(.*)&quot;)</tt> will match <tt>foo(String, String, String[])</tt>. If the url is <tt>/operation/a/b/c/d/e</tt> you&#x2019;ll get <tt>foo(&quot;a&quot;, &quot;b&quot;, { &quot;c&quot;, &quot;d&quot;, &quot;e&quot; })</tt>.</p></div></div></div>
                  </div>
          </div>

    <hr/>

    <footer>
            <div class="container">
              <div class="row span12">Copyright &copy;                    2008-2013
                        <a href="http://www.apache.org/">The Apache Software Foundation</a>.
            All Rights Reserved.      
                    
      </div>

        
                <p id="poweredBy" class="pull-right">
                                                                                                                <a href="http://www.apache.org/events/current-event.html" title="ApacheCon" class="builtBy">
        <img class="builtBy"  alt="ApacheCon" src="http://www.apache.org/events/current-event-125x125.png"    />
      </a>
                                                                                                    <a href="http://maven.apache.org/" title="Maven" class="builtBy">
        <img class="builtBy"  alt="Maven" src="http://maven.apache.org/images/logos/maven-feather.png"    />
      </a>
                  </p>
        
                </div>
    </footer>
  </body>
</html>
